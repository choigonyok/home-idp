// protoc --go_out=rbac-manager/pkg/proto --go-grpc_out=rbac-manager/pkg/proto rbac-manager/pkg/proto/rbac.proto
syntax = "proto3";

package proto;

option go_package = "./";

service RbacService {
  rpc Check (RbacRequest) returns (RbacReply) {}
  rpc GetRoles (GetRolesRequest) returns (GetRolesReply) {}
  rpc GetRole (GetRoleRequest) returns (GetRoleReply) {}
  rpc GetPolicies (GetPoliciesRequest) returns (GetPoliciesReply) {}
  rpc GetProjects (GetProjectsRequest) returns (GetProjectsReply) {}
  rpc GetUsers (GetUsersRequest) returns (GetUsersReply) {}
  rpc PostUser (PostUserRequest) returns (PostUserReply) {}
  rpc PutUser (PutUserRequest) returns (PutUserReply) {}
}


enum Action {
  CREATE = 0;
  RETRIEVE = 1;
  UPDATE = 2;
  DELETE = 3;
}

enum Result {
  ASK = 0;
  ALLOW = 1;
  DENY = 2;
  ERROR = 3;
}

message RbacRequest {
  string username = 1;
  string target = 2;
  Action action = 3;
}

message RbacReply {
  Result result  = 1;
}

message Role {
  string id = 1;
  string name = 2;
}

message GetRolesRequest {}

message GetRolesReply {
  repeated Role roles = 1;
}

message GetRoleRequest {
  string userId = 1;
}

message GetRoleReply {
  Role role = 1;
}

message Policy {
  string id = 1;
  string name = 2;
  string json = 3;
}

message GetPoliciesRequest {
  string roleId = 1;
}

message GetPoliciesReply {
  repeated Policy policies = 1;
}

message Project {
  string id = 1;
  string name = 2;
  string creator = 3;
}


message GetProjectsRequest {
  string userId = 1;
}

message GetProjectsReply {
  repeated Project projects = 1;
}

message User {
  string id = 1;
  string name = 2;
  string roleId = 3;
  string createTime = 4;
}


message GetUsersRequest {
  string userId = 1;
  string projectName = 2;
}

message GetUsersReply {
  repeated User users = 1;
}

message PostUserRequest {
  User user = 1;
  string projectName = 2;
}

message PostUserReply {
  Error error = 1;
}

message Error {
  string error = 1;
}

message PutUserRequest {
  string userId = 1;
  User user = 2;
}

message PutUserReply {
  Error error = 1;
}